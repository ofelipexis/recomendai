(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function k(e){let n="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<e;o+=1)n+=t.charAt(Math.floor(Math.random()*t.length));return n}async function T(e){const n=new TextEncoder().encode(e),t=await window.crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(t)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function L(e){const n=k(128),t=await T(n);sessionStorage.setItem("verifier",n);const o=new URLSearchParams;o.append("client_id",e),o.append("response_type","code"),o.append("redirect_uri","https://ofelipexis.github.io/recomendai/"),o.append("scope","playlist-modify-public user-top-read"),o.append("code_challenge_method","S256"),o.append("code_challenge",t),document.location=`https://accounts.spotify.com/authorize?${o.toString()}`}async function v(e,n){const t=sessionStorage.getItem("verifier");if(t&&n!==null){const o=new URLSearchParams;o.append("client_id",e),o.append("grant_type","authorization_code"),o.append("code",n),o.append("redirect_uri","https://ofelipexis.github.io/recomendai/"),o.append("code_verifier",t),await fetch("https://accounts.spotify.com/api/token?",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then(s=>{if(!s.ok)throw sessionStorage.clear(),window.location.reload(),new Error(`HTTP status  ${s.status}`);return s.json()}).then(s=>{sessionStorage.setItem("access_token",s.access_token)}).catch(s=>{throw new Error(`Error: ${s}`)})}}function E(e,n,t){e.addEventListener("click",()=>{let o=n.get("code");o||L(t),o=n.get("code"),v(t,o)})}async function q(e){const n=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw n.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${n.status}`);const t=await n.json();let o;return t!=null&&(o=t.id),o}function d(e){e&&e.preventDefault();const n=window.innerHeight,t=document.querySelector(".header-container").offsetHeight,o=document.querySelector(".main-container").offsetHeight,s=document.querySelector(".footer-container").offsetHeight,a=document.querySelector("footer");o<=n-(t+s)?a.classList.add("bottom-0"):a.classList.contains("bottom-0")&&a.classList.remove("bottom-0")}function C(){const e=document.querySelectorAll(".track-information"),n="track-selected";e.length&&e.forEach(t=>{t.addEventListener("click",()=>{t.classList.contains(n)?t.classList.remove(n):t.classList.add(n)})})}function A(){const e=document.querySelectorAll(".track-information"),n="track-selected";e.length&&e.forEach(t=>{t.classList.remove(n)})}function $(e,n,t,o){(e||sessionStorage.getItem("code"))&&(t.removeChild(o),t.innerHTML=`
    <div class="selection-container">
      <div class="selection">
        <div class="selection-text">
          <p>escolha o período</p>
        </div>
        <div class="btn-container period-select">
          <button id="shortTerm" class="btn btn-small selection-btn">últimos 30 dias</button>
          <button id="mediumTerm" class="btn btn-small selection-btn">últimos 6 meses</button>
          <button id="longTerm" class="btn btn-small selection-btn">desde o início</button>
        </div>
      </div>
      
      <div class="selection">
        <div class="selection-text">
          <p>e a quantidade de músicas</p>
        </div>
        <div class="btn-container quantity-select">
          <button class="btn btn-small selection-btn" id="9">9 músicas</button>
          <button class="btn btn-small selection-btn" id="12">12 músicas</button>
          <button class="btn btn-small selection-btn" id="15">15 músicas</button>
          <button class="btn btn-small selection-btn" id="18">18 músicas</button>
        </div>
        
        <div class="get-tracks-container">
          <button class="btn btn-large btn-start get-tracks">vamos lá!</button>
        </div>
        
      </div>
    </div>
    `,t.classList.add("decrease-padding"),sessionStorage.getItem("access_token")||(sessionStorage.setItem("code",e),v(n,e)),d())}function P(e){if(e!=null){const n=document.querySelector(".main-container"),t=document.querySelector(".selection-container");n&&t&&(n.removeChild(t),n.innerHTML=`
      <div class="user-tracks-container">
        <p>agora escolha suas favoritas</p>
        <p>(no mínimo uma e no máximo todas)</p>
        <div class="tracks-information-container">
        </div>
        <div class="btn-container">
        <button class="btn btn-large go-back-btn">voltar</button>
        <button class="btn btn-large clear-selection-btn">limpar</button> 
        <button class="btn btn-large btn-start get-recommendations">recomenda<span>í</span></button>
        </div>
      </div>
      `);const o=document.querySelector(".tracks-information-container");o&&e.items.forEach(i=>{const r=document.createElement("div");r.classList.add("track-information"),r.dataset.artistid=`${i.artists[0].id}`,r.id=i.id;const l=document.createElement("div");l.classList.add("track-title"),l.innerHTML=`${i.name}`;const u=document.createElement("div");u.classList.add("track-artist");const m=i.artists.map(p=>p.name).join(", ");u.innerHTML=`${m}`,r.appendChild(l),r.appendChild(u),o.appendChild(r)}),d(),window.addEventListener("resize",d),C();const s=document.querySelector(".go-back-btn");s&&s.addEventListener("click",()=>{window.location.reload()});const a=document.querySelector(".clear-selection-btn");a&&a.addEventListener("click",A);const c=document.querySelector(".get-recommendations");c&&c.addEventListener("click",j)}}function H(e){if(e!=null){const n=document.querySelector(".main-container"),t=document.querySelector(".user-tracks-container");n&&t&&(n.removeChild(t),n.innerHTML=`
      <div class="recommendation-tracks-container">
        <p>aqui estão nossas recomendações para você!</p>
        <div class="tracks-information-container">
        </div>
        <div class="btn-container">
        <button class="btn btn-large go-back-btn">refazer</button>
        <button class="btn btn-large btn-start save-playlist">salvar playlist</button>
        </div
      </div>
      `);const o=document.querySelector(".tracks-information-container");o&&e.forEach(c=>{const i=document.createElement("div");i.classList.add("recommendation-track-information"),i.dataset.artistid=`${c.artists[0].id}`,i.dataset.uri=`${c.uri}`,i.id=`${c.artists[0].id}`;const r=document.createElement("div");r.classList.add("track-title"),r.innerHTML=`${c.name}`;const l=document.createElement("div");l.classList.add("track-artist");const f=c.artists.map(m=>m.name).join(", ");l.innerHTML=`${f}`,i.appendChild(r),i.appendChild(l),o.appendChild(i)}),d(),window.addEventListener("resize",d);const s=document.querySelector(".go-back-btn");s&&s.addEventListener("click",()=>{window.location.reload()});const a=document.querySelector(".save-playlist");a&&a.addEventListener("click",M)}}async function B(e,n,t){const o=n.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase(),s=new URLSearchParams;s.append("time_range",o),s.append("limit",t),await fetch(`https://api.spotify.com/v1/me/top/tracks?${s.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then(a=>{if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);return a.json()}).then(a=>{P(a),d()}).finally()}async function I(e,n){const t=[],o=n.map(async s=>{const a=await fetch(`https://api.spotify.com/v1/artists/${s}/related-artists`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);const c=await a.json();c!=null&&c.artists.forEach(i=>{t.includes(i.id)||t.push(i.id)})});return await Promise.all(o),t}async function _(e,n){const t=[],o=n.map(async s=>{const a=await fetch(`https://api.spotify.com/v1/artists/${s}/top-tracks?market=BR`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);const c=await a.json();if(c!=null){const i=Math.floor(Math.random()*c.tracks.length);t.push(c.tracks[i])}});await Promise.all(o),H(t),d()}async function M(){if(sessionStorage.getItem("access_token")){const e=sessionStorage.getItem("access_token"),n=await q(e);if(n){const t=new Date,o=t.getUTCFullYear(),s=(t.getUTCMonth()+1).toString().padStart(2,"0"),a=t.getUTCDate().toString().padStart(2,"0"),c={name:`recomendaí #${o}-${s}-${a}`,description:"",public:!0},i=await fetch(`https://api.spotify.com/v1/users/${n}/playlists`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw i.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${i.status}`);const r=await i.json();if(r!=null){const l=r.id,u=document.querySelectorAll(".recommendation-track-information"),f=[];if(u&&u.forEach(g=>{f.push(g.dataset.uri)}),f!==""){const g={uris:f},h=await fetch(`https://api.spotify.com/v1/playlists/${l}/tracks`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(g)});if(h.status!==201)throw h.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${h.status}`);await h.json()}const m=document.querySelector("#playlist-container"),p=document.querySelector(".btn-playlist"),b=document.querySelector("#close-playlist");m&&p&&b&&(p.href=`${r.external_urls.spotify}`,m.style.display="block",b.addEventListener("click",()=>{m.style.display="none"}))}}}}const y="btn-selected";function z(){const e=document.querySelectorAll(".period-select button");function n(t){e.forEach(o=>{o.classList.remove(y)}),e[t].classList.add(y)}e.length&&e.forEach((t,o)=>{t.addEventListener("click",()=>{n(o)})})}function R(){const e=document.querySelectorAll(".quantity-select button");function n(t){e.forEach(o=>{o.classList.remove(y)}),e[t].classList.add(y)}e.length&&e.forEach((t,o)=>{t.addEventListener("click",()=>{n(o)})})}async function O(){const e=document.querySelector(".get-tracks");e&&e.addEventListener("click",async()=>{const n=document.querySelector(".period-select").children,t=document.querySelector(".quantity-select").children;if(n&&t){const o=Array.from(n);let s;o.forEach(i=>{i.classList.contains("btn-selected")&&(s=i)});const a=Array.from(t);let c;if(a.forEach(i=>{i.classList.contains("btn-selected")&&(c=i)}),!s||!c){const i=document.querySelector(".get-tracks-container");if(i&&e&&i.childElementCount<=1){const r=document.createElement("div");r.classList.add("error"),r.innerHTML="o período e quantidade de músicas são itens obrigatórios",i.insertBefore(r,e)}}else{const i=document.querySelector(".get-tracks-container");if(i.firstElementChild.classList.contains("error")&&i.removeChild(i.firstElementChild),sessionStorage.getItem("access_token")){const r=sessionStorage.getItem("access_token"),l=s.id,u=c.id;await B(r,l,u)}}}})}async function j(){const e=document.querySelector(".tracks-information-container");if(e){const n=e.querySelectorAll(".track-selected"),t=[];if(n&&n.length>0&&n.forEach(o=>{t.includes(o.dataset.artistid)||t.push(o.dataset.artistid)}),t.length>0&&sessionStorage.getItem("access_token")){const o=sessionStorage.getItem("access_token"),s=await I(o,t),a=[];if(s.length>18)for(;a.length<18;){const c=Math.floor(Math.random()*s.length);a.includes(s[c])||a.push(s[c])}await _(o,a)}}}function x(){const e=localStorage.getItem("termsAccepted"),n=document.querySelector("#close-terms"),t=document.querySelector("#terms-modal");(!e||e==="false")&&(t.style.display="block"),n.addEventListener("click",()=>{localStorage.setItem("termsAccepted",!0),t.style.display="none"})}function F(){const e=document.querySelector("#privacy-policy"),n=document.querySelector("#terms-modal");e.addEventListener("click",()=>{n.style.display="block"})}const w="c8661c301a44457faf463b92960756b2",S=new URLSearchParams(window.location.search),U=S.get("code"),G=document.querySelector(".main-container"),N=document.querySelector(".start-container"),D=document.querySelector(".btn-start");E(D,S,w);$(U,w,G,N);d();z();R();O();d();x();F();window.addEventListener("resize",d);
