(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function S(o){let n="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<o;e+=1)n+=t.charAt(Math.floor(Math.random()*t.length));return n}async function L(o){const n=new TextEncoder().encode(o),t=await window.crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(t)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function E(o){const n=S(128),t=await L(n);sessionStorage.setItem("verifier",n);const e=new URLSearchParams;e.append("client_id",o),e.append("response_type","code"),e.append("redirect_uri","https://ofelipexis.github.io/recomendai/"),e.append("scope","playlist-modify-public user-top-read"),e.append("code_challenge_method","S256"),e.append("code_challenge",t),document.location=`https://accounts.spotify.com/authorize?${e.toString()}`}async function v(o,n){const t=sessionStorage.getItem("verifier");if(t&&n!==null){const e=new URLSearchParams;e.append("client_id",o),e.append("grant_type","authorization_code"),e.append("code",n),e.append("redirect_uri","https://ofelipexis.github.io/recomendai/"),e.append("code_verifier",t),await fetch("https://accounts.spotify.com/api/token?",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}).then(s=>{if(!s.ok)throw sessionStorage.clear(),window.location.reload(),new Error(`HTTP status  ${s.status}`);return s.json()}).then(s=>{sessionStorage.setItem("access_token",s.access_token)}).catch(s=>{throw new Error(`Error: ${s}`)})}}function T(o,n,t){o.addEventListener("click",()=>{let e=n.get("code");e||E(t),e=n.get("code"),v(t,e)})}async function C(o){const n=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${o}`}});if(!n.ok)throw n.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${n.status}`);const t=await n.json();let e;return t!=null&&(e=t.id),e}function p(o){o&&o.preventDefault();const n=window.innerHeight,t=document.querySelector(".header-container").offsetHeight,e=document.querySelector(".main-container").offsetHeight,s=document.querySelector(".footer-container").offsetHeight,a=document.querySelector("footer");e<=n-(t+s)?a.classList.add("bottom-0"):a.classList.contains("bottom-0")&&a.classList.remove("bottom-0")}function q(){const o=document.querySelectorAll(".track-information"),n="selected";o.length&&o.forEach(t=>{t.addEventListener("click",()=>{t.classList.contains(n)?t.classList.remove(n):t.classList.add(n)})})}function $(){const o=document.querySelectorAll(".track-information"),n="selected";o.length&&o.forEach(t=>{t.classList.remove(n)})}function A(o,n,t,e){(o||sessionStorage.getItem("code"))&&(t.removeChild(e),t.innerHTML=`
    <div class="selection-container">
      <div class="selection">
        <div class="selection-text">
          <p>escolha o período</p>
        </div>
        <div class="btn-container period-select">
          <button id="shortTerm" class="selection-btn">últimos 30 dias</button>
          <button id="mediumTerm" class="selection-btn">últimos 6 meses</button>
          <button id="longTerm" class="selection-btn">desde o início</button>
        </div>
      </div>
      
      <div class="selection">
        <div class="selection-text">
          <p>e a quantidade de músicas</p>
        </div>
        <div class="btn-container quantity-select">
          <button class="selection-btn">9</button>
          <button class="selection-btn">12</button>
          <button class="selection-btn">15</button>
          <button class="selection-btn">18</button>
        </div>
        
        <div class="get-tracks-container">
          <button class="btn-start get-tracks">vamos lá!</button>
        </div>
        
      </div>
    </div>
    `,t.classList.add("decrease-padding"),sessionStorage.getItem("access_token")||(sessionStorage.setItem("code",o),v(n,o)),p())}function H(o){if(o!=null){const n=document.querySelector(".main-container"),t=document.querySelector(".selection-container");n&&t&&(n.removeChild(t),n.innerHTML=`
      <div class="user-tracks-container">
        <p>agora escolha suas favoritas</p>
        <p>(no mínimo uma e no máximo todas)</p>
        <div class="tracks-information-container">
        </div>
        <div class="btn-container">
        <button class="go-back-btn">voltar</button>
        <button class="clear-selection-btn">limpar</button> 
        <button class="btn-start get-recommendations">recomenda<span>í</span></button>
        </div
      </div>
      `);const e=document.querySelector(".tracks-information-container");e&&o.items.forEach(i=>{const r=document.createElement("div");r.classList.add("track-information"),r.dataset.artistid=`${i.artists[0].id}`,r.id=i.id;const u=document.createElement("div");u.classList.add("track-info-left");const d=document.createElement("img");d.src=`${i.album.images[0].url}`,d.alt=`album cover: ${i.album.name}`,u.appendChild(d);const l=document.createElement("div");l.classList.add("track-info-right");const m=document.createElement("div");m.classList.add("track-title"),m.innerHTML=`${i.name}`;const f=document.createElement("div");f.classList.add("track-artist");const g=i.artists.map(k=>k.name).join(", ");f.innerHTML=`${g}`,l.appendChild(m),l.appendChild(f),r.appendChild(u),r.appendChild(l),e.appendChild(r)}),window.addEventListener("resize",p),p(),q();const s=document.querySelector(".go-back-btn");s&&s.addEventListener("click",()=>{window.location.reload()});const a=document.querySelector(".clear-selection-btn");a&&a.addEventListener("click",$);const c=document.querySelector(".get-recommendations");c&&c.addEventListener("click",j)}}function P(o){if(o!=null){const n=document.querySelector(".main-container"),t=document.querySelector(".user-tracks-container");n&&t&&(n.removeChild(t),n.innerHTML=`
      <div class="recommendation-tracks-container">
        <p>aqui estão nossas recomendações para você!</p>
        <div class="tracks-information-container">
        </div>
        <div class="btn-container">
        <button class="go-back-btn">refazer</button>
        <button class="btn-start save-playlist">salvar playlist</button>
        </div
      </div>
      `);const e=document.querySelector(".tracks-information-container");e&&o.forEach(c=>{const i=document.createElement("div");i.classList.add("track-information"),i.dataset.artistid=`${c.artists[0].id}`,i.dataset.uri=`${c.uri}`;const r=document.createElement("div");r.classList.add("track-info-left");const u=document.createElement("img");u.src=`${c.album.images[0].url}`,u.alt=`album cover: ${c.album.name}`,r.appendChild(u);const d=document.createElement("div");d.classList.add("track-info-right");const l=document.createElement("div");l.classList.add("track-title"),l.innerHTML=`${c.name}`;const m=document.createElement("div");m.classList.add("track-artist");const y=c.artists.map(g=>g.name).join(", ");m.innerHTML=`${y}`,d.appendChild(l),d.appendChild(m),i.appendChild(r),i.appendChild(d),e.appendChild(i)}),window.addEventListener("resize",p),p();const s=document.querySelector(".go-back-btn");s&&s.addEventListener("click",()=>{window.location.reload()});const a=document.querySelector(".save-playlist");a&&a.addEventListener("click",M)}}async function I(o,n,t){const e=n.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase(),s=new URLSearchParams;s.append("time_range",e),s.append("limit",t),await fetch(`https://api.spotify.com/v1/me/top/tracks?${s.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${o}`}}).then(a=>{if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);return a.json()}).then(a=>{H(a),p()}).finally()}async function _(o,n){const t=[],e=n.map(async s=>{const a=await fetch(`https://api.spotify.com/v1/artists/${s}/related-artists`,{method:"GET",headers:{Authorization:`Bearer ${o}`}});if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);const c=await a.json();c!=null&&c.artists.forEach(i=>{t.includes(i.id)||t.push(i.id)})});return await Promise.all(e),t}async function B(o,n){const t=[],e=n.map(async s=>{const a=await fetch(`https://api.spotify.com/v1/artists/${s}/top-tracks?market=BR`,{method:"GET",headers:{Authorization:`Bearer ${o}`}});if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);const c=await a.json();if(c!=null){const i=Math.floor(Math.random()*c.tracks.length);t.push(c.tracks[i])}});await Promise.all(e),P(t)}async function M(){if(sessionStorage.getItem("access_token")){const o=sessionStorage.getItem("access_token"),n=await C(o);if(n){const t=new Date,e=t.getUTCFullYear(),s=(t.getUTCMonth()+1).toString().padStart(2,"0"),a=t.getUTCDate().toString().padStart(2,"0"),c={name:`recomendaí #${e}-${s}-${a}`,description:"",public:!0},i=await fetch(`https://api.spotify.com/v1/users/${n}/playlists`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw i.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${i.status}`);const r=await i.json();if(r!=null){const u=r.id,d=document.querySelectorAll(".track-information"),l=[];if(d&&d.forEach(m=>{l.push(m.dataset.uri)}),l!==""){const m={uris:l},f=await fetch(`https://api.spotify.com/v1/playlists/${u}/tracks`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify(m)});if(f.status!==201)throw f.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${f.status}`);await f.json()}}}}}const h="selected";function R(){const o=document.querySelectorAll(".period-select button");function n(t){o.forEach(e=>{e.classList.remove(h)}),o[t].classList.add(h)}o.length&&o.forEach((t,e)=>{t.addEventListener("click",()=>{n(e)})})}function z(){const o=document.querySelectorAll(".quantity-select button");function n(t){o.forEach(e=>{e.classList.remove(h)}),o[t].classList.add(h)}o.length&&o.forEach((t,e)=>{t.addEventListener("click",()=>{n(e)})})}async function O(){const o=document.querySelector(".get-tracks");o&&o.addEventListener("click",async()=>{const n=document.querySelector(".period-select").children,t=document.querySelector(".quantity-select").children;if(n&&t){const e=Array.from(n);let s;e.forEach(i=>{i.classList.contains("selected")&&(s=i)});const a=Array.from(t);let c;if(a.forEach(i=>{i.classList.contains("selected")&&(c=i)}),!s||!c){const i=document.querySelector(".get-tracks-container");if(i&&o&&i.childElementCount<=1){const r=document.createElement("div");r.classList.add("error"),r.innerHTML="o período e quantidade de músicas são itens obrigatórios",i.insertBefore(r,o)}}else{const i=document.querySelector(".get-tracks-container");if(i.firstElementChild.classList.contains("error")&&i.removeChild(i.firstElementChild),sessionStorage.getItem("access_token")){const r=sessionStorage.getItem("access_token"),u=s.id,d=c.innerHTML;await I(r,u,d)}}}})}async function j(){const o=document.querySelector(".tracks-information-container");if(o){const n=o.querySelectorAll(".selected"),t=[];if(n&&n.length>0&&n.forEach(e=>{t.includes(e.dataset.artistid)||t.push(e.dataset.artistid)}),t.length>0&&sessionStorage.getItem("access_token")){const e=sessionStorage.getItem("access_token"),s=await _(e,t),a=[];if(s.length>18)for(;a.length<18;){const c=Math.floor(Math.random()*s.length);a.includes(s[c])||a.push(s[c])}await B(e,a)}}}const w="c8661c301a44457faf463b92960756b2",b=new URLSearchParams(window.location.search),F=b.get("code"),U=document.querySelector(".main-container"),x=document.querySelector(".start-container"),G=document.querySelector(".btn-start");T(G,b,w);A(F,w,U,x);p();R();z();O();p();window.addEventListener("resize",p);
