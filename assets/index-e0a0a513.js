(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function T(e){let n="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<e;o+=1)n+=t.charAt(Math.floor(Math.random()*t.length));return n}async function C(e){const n=new TextEncoder().encode(e),t=await window.crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(t)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function q(e){const n=T(128),t=await C(n);sessionStorage.setItem("verifier",n);const o=new URLSearchParams;o.append("client_id",e),o.append("response_type","code"),o.append("redirect_uri","https://ofelipexis.github.io/recomendai/"),o.append("scope","playlist-modify-public user-top-read"),o.append("code_challenge_method","S256"),o.append("code_challenge",t),document.location=`https://accounts.spotify.com/authorize?${o.toString()}`}async function w(e,n){const t=sessionStorage.getItem("verifier");if(t&&n!==null){const o=new URLSearchParams;o.append("client_id",e),o.append("grant_type","authorization_code"),o.append("code",n),o.append("redirect_uri","https://ofelipexis.github.io/recomendai/"),o.append("code_verifier",t),await fetch("https://accounts.spotify.com/api/token?",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then(s=>{if(!s.ok)throw sessionStorage.clear(),window.location.reload(),new Error(`HTTP status  ${s.status}`);return s.json()}).then(s=>{sessionStorage.setItem("access_token",s.access_token)}).catch(s=>{throw new Error(`Error: ${s}`)})}}function $(e,n,t){e.addEventListener("click",()=>{let o=n.get("code");o||q(t),o=n.get("code"),w(t,o)})}async function A(e){const n=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw n.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${n.status}`);const t=await n.json();let o;return t!=null&&(o=t.id),o}function g(e){e&&e.preventDefault();const n=window.innerHeight,t=document.querySelector(".header-container").offsetHeight,o=document.querySelector(".main-container").offsetHeight,s=document.querySelector(".footer-container").offsetHeight,a=document.querySelector("footer");o<=n-(t+s)?a.classList.add("bottom-0"):a.classList.contains("bottom-0")&&a.classList.remove("bottom-0")}function P(){const e=document.querySelectorAll(".track-information"),n="track-selected";e.length&&e.forEach(t=>{t.addEventListener("click",()=>{t.classList.contains(n)?t.classList.remove(n):t.classList.add(n)})})}function I(){const e=document.querySelectorAll(".track-information"),n="track-selected";e.length&&e.forEach(t=>{t.classList.remove(n)})}function _(e,n,t,o){(e||sessionStorage.getItem("code"))&&(t.removeChild(o),t.innerHTML=`
    <div class="selection-container">
      <div class="selection">
        <div class="selection-text">
          <p>escolha o período</p>
        </div>
        <div class="btn-container period-select">
          <button id="shortTerm" class="btn btn-small selection-btn">últimos 30 dias</button>
          <button id="mediumTerm" class="btn btn-small selection-btn">últimos 6 meses</button>
          <button id="longTerm" class="btn btn-small selection-btn">desde o início</button>
        </div>
      </div>
      
      <div class="selection">
        <div class="selection-text">
          <p>e a quantidade de músicas</p>
        </div>
        <div class="btn-container quantity-select">
          <button class="btn btn-small selection-btn" id="9">9 músicas</button>
          <button class="btn btn-small selection-btn" id="12">12 músicas</button>
          <button class="btn btn-small selection-btn" id="15">15 músicas</button>
          <button class="btn btn-small selection-btn" id="18">18 músicas</button>
        </div>
        
        <div class="get-tracks-container">
          <button class="btn btn-large btn-start get-tracks">vamos lá!</button>
        </div>
        
      </div>
    </div>
    `,t.classList.add("decrease-padding"),sessionStorage.getItem("access_token")||(sessionStorage.setItem("code",e),w(n,e)),g())}function H(e){if(e!=null){const n=document.querySelector(".main-container"),t=document.querySelector(".selection-container");n&&t&&(n.removeChild(t),n.innerHTML=`
      <div class="user-tracks-container">
        <p>agora escolha suas favoritas</p>
        <p>(no mínimo uma e no máximo todas)</p>
        <div class="tracks-information-container">
        </div>
        <div class="btn-container">
        <button class="btn btn-large go-back-btn">voltar</button>
        <button class="btn btn-large clear-selection-btn">limpar</button> 
        <button class="btn btn-large btn-start get-recommendations">recomenda<span>í</span></button>
        </div>
      </div>
      `);const o=document.querySelector(".tracks-information-container");o&&e.items.forEach(i=>{const r=document.createElement("div");r.classList.add("track-information"),r.dataset.artistid=`${i.artists[0].id}`,r.id=i.id;const d=document.createElement("div");d.classList.add("track-info-left");const l=document.createElement("a");l.title="tocar no spotify",l.target="_blank",l.href=`${i.external_urls.spotify}`;const u=document.createElement("img");u.src=`${i.album.images[0].url}`,u.alt=`album cover: ${i.album.name}`;const p=document.createElement("div");p.classList.add("overlay");const h=document.createElement("img");h.src="/src/img/play.svg",p.appendChild(h),l.appendChild(u),l.appendChild(p),d.appendChild(l);const m=document.createElement("div");m.classList.add("track-info-right");const f=document.createElement("div");f.classList.add("track-title"),f.innerHTML=`${i.name}`;const y=document.createElement("div");y.classList.add("track-artist");const v=i.artists.map(L=>L.name).join(", ");y.innerHTML=`${v}`,m.appendChild(f),m.appendChild(y),r.appendChild(d),r.appendChild(m),o.appendChild(r)}),window.addEventListener("resize",g),g(),P();const s=document.querySelector(".go-back-btn");s&&s.addEventListener("click",()=>{window.location.reload()});const a=document.querySelector(".clear-selection-btn");a&&a.addEventListener("click",I);const c=document.querySelector(".get-recommendations");c&&c.addEventListener("click",U)}}function B(e){if(e!=null){const n=document.querySelector(".main-container"),t=document.querySelector(".user-tracks-container");n&&t&&(n.removeChild(t),n.innerHTML=`
      <div class="recommendation-tracks-container">
        <p>aqui estão nossas recomendações para você!</p>
        <div class="tracks-information-container">
        </div>
        <div class="btn-container">
        <button class="btn btn-large go-back-btn">refazer</button>
        <button class="btn btn-large btn-start save-playlist">salvar playlist</button>
        </div
      </div>
      `);const o=document.querySelector(".tracks-information-container");o&&e.forEach(c=>{const i=document.createElement("div");i.classList.add("recommendation-track-information"),i.dataset.artistid=`${c.artists[0].id}`,i.dataset.uri=`${c.uri}`,i.id=`${c.artists[0].id}`;const r=document.createElement("div");r.classList.add("track-info-left");const d=document.createElement("a");d.title="tocar no spotify",d.target="_blank",d.href=`${c.external_urls.spotify}`;const l=document.createElement("img");l.src=`${c.album.images[0].url}`,l.alt=`album cover: ${c.album.name}`;const u=document.createElement("div");u.classList.add("overlay");const p=document.createElement("img");p.src="/src/img/play.svg",u.appendChild(p),d.appendChild(l),d.appendChild(u),r.appendChild(d);const h=document.createElement("div");h.classList.add("track-info-right");const m=document.createElement("div");m.classList.add("track-title"),m.innerHTML=`${c.name}`;const f=document.createElement("div");f.classList.add("track-artist");const k=c.artists.map(v=>v.name).join(", ");f.innerHTML=`${k}`,h.appendChild(m),h.appendChild(f),i.appendChild(r),i.appendChild(h),o.appendChild(i)}),window.addEventListener("resize",g),g();const s=document.querySelector(".go-back-btn");s&&s.addEventListener("click",()=>{window.location.reload()});const a=document.querySelector(".save-playlist");a&&a.addEventListener("click",O)}}async function M(e,n,t){const o=n.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase(),s=new URLSearchParams;s.append("time_range",o),s.append("limit",t),await fetch(`https://api.spotify.com/v1/me/top/tracks?${s.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then(a=>{if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);return a.json()}).then(a=>{H(a),g()}).finally()}async function R(e,n){const t=[],o=n.map(async s=>{const a=await fetch(`https://api.spotify.com/v1/artists/${s}/related-artists`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);const c=await a.json();c!=null&&c.artists.forEach(i=>{t.includes(i.id)||t.push(i.id)})});return await Promise.all(o),t}async function z(e,n){const t=[],o=n.map(async s=>{const a=await fetch(`https://api.spotify.com/v1/artists/${s}/top-tracks?market=BR`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw a.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${a.status}`);const c=await a.json();if(c!=null){const i=Math.floor(Math.random()*c.tracks.length);t.push(c.tracks[i])}});await Promise.all(o),B(t)}async function O(){if(sessionStorage.getItem("access_token")){const e=sessionStorage.getItem("access_token"),n=await A(e);if(n){const t=new Date,o=t.getUTCFullYear(),s=(t.getUTCMonth()+1).toString().padStart(2,"0"),a=t.getUTCDate().toString().padStart(2,"0"),c={name:`recomendaí #${o}-${s}-${a}`,description:"",public:!0},i=await fetch(`https://api.spotify.com/v1/users/${n}/playlists`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw i.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${i.status}`);const r=await i.json();if(r!=null){const d=r.id,l=document.querySelectorAll(".recommendation-track-information"),u=[];if(l&&l.forEach(f=>{u.push(f.dataset.uri)}),u!==""){const f={uris:u},y=await fetch(`https://api.spotify.com/v1/playlists/${d}/tracks`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(f)});if(y.status!==201)throw y.status===401&&(sessionStorage.clear(),window.location.reload()),new Error(`HTTP status  ${y.status}`);await y.json()}const p=document.querySelector("#playlist-container"),h=document.querySelector(".btn-playlist"),m=document.querySelector("#close-playlist");p&&h&&m&&(h.href=`${r.external_urls.spotify}`,p.style.display="block",m.addEventListener("click",()=>{p.style.display="none"}))}}}}const b="btn-selected";function x(){const e=document.querySelectorAll(".period-select button");function n(t){e.forEach(o=>{o.classList.remove(b)}),e[t].classList.add(b)}e.length&&e.forEach((t,o)=>{t.addEventListener("click",()=>{n(o)})})}function j(){const e=document.querySelectorAll(".quantity-select button");function n(t){e.forEach(o=>{o.classList.remove(b)}),e[t].classList.add(b)}e.length&&e.forEach((t,o)=>{t.addEventListener("click",()=>{n(o)})})}async function F(){const e=document.querySelector(".get-tracks");e&&e.addEventListener("click",async()=>{const n=document.querySelector(".period-select").children,t=document.querySelector(".quantity-select").children;if(n&&t){const o=Array.from(n);let s;o.forEach(i=>{i.classList.contains("btn-selected")&&(s=i)});const a=Array.from(t);let c;if(a.forEach(i=>{i.classList.contains("btn-selected")&&(c=i)}),!s||!c){const i=document.querySelector(".get-tracks-container");if(i&&e&&i.childElementCount<=1){const r=document.createElement("div");r.classList.add("error"),r.innerHTML="o período e quantidade de músicas são itens obrigatórios",i.insertBefore(r,e)}}else{const i=document.querySelector(".get-tracks-container");if(i.firstElementChild.classList.contains("error")&&i.removeChild(i.firstElementChild),sessionStorage.getItem("access_token")){const r=sessionStorage.getItem("access_token"),d=s.id,l=c.id;await M(r,d,l)}}}})}async function U(){const e=document.querySelector(".tracks-information-container");if(e){const n=e.querySelectorAll(".track-selected"),t=[];if(n&&n.length>0&&n.forEach(o=>{t.includes(o.dataset.artistid)||t.push(o.dataset.artistid)}),t.length>0&&sessionStorage.getItem("access_token")){const o=sessionStorage.getItem("access_token"),s=await R(o,t),a=[];if(s.length>18)for(;a.length<18;){const c=Math.floor(Math.random()*s.length);a.includes(s[c])||a.push(s[c])}await z(o,a)}}}function G(){const e=localStorage.getItem("termsAccepted"),n=document.querySelector("#close-terms"),t=document.querySelector("#terms-modal");(!e||e==="false")&&(t.style.display="block"),n.addEventListener("click",()=>{localStorage.setItem("termsAccepted",!0),t.style.display="none"})}function N(){const e=document.querySelector("#privacy-policy"),n=document.querySelector("#terms-modal");e.addEventListener("click",()=>{n.style.display="block"})}const S="c8661c301a44457faf463b92960756b2",E=new URLSearchParams(window.location.search),D=E.get("code"),V=document.querySelector(".main-container"),J=document.querySelector(".start-container"),W=document.querySelector(".btn-start");$(W,E,S);_(D,S,V,J);g();x();j();F();g();G();N();window.addEventListener("resize",g);
